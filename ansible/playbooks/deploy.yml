- hosts: localhost
  connection: local

  tasks:

    - name: Apply Deployment
      command: kubectl apply -f ../../k8s/base/deployment.yml
      environment:
        KUBECONFIG: /var/lib/jenkins/.kube/config

    - name: Apply Service
      command: kubectl apply -f ../../k8s/base/service.yml
      environment:
        KUBECONFIG: /var/lib/jenkins/.kube/config

    - name: Wait for rollout
      command: kubectl rollout status deployment/myapp
      environment:
        KUBECONFIG: /var/lib/jenkins/.kube/config
